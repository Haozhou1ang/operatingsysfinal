# 项目修改记录（截至目前）

> 说明：本文件汇总了截至当前的主要修改点，聚焦于客户端 CLI 体验优化与 TCP 传输层健壮性增强。

## 1. 客户端 CLI 输出与交互美化

- **ANSI 颜色/样式常量**：新增用于标题、提示符、状态、告警等的颜色与样式常量，统一 CLI 风格。
- **响应输出格式**：
  - 成功输出使用 `✔ [OK]`，失败输出使用 `✖ [ERROR] code msg`，并保留响应 body 原样显示。
- **帮助信息优化**：
  - 增加标题与分隔线；
  - 使用 `std::setw` 对齐 usage/desc；
  - 按角色/权限分组展示业务命令；
  - 提升可读性与扫读效率。
- **提示符优化**：
  - 统一使用 `client▸` 样式提示符；
  - 颜色高亮并保留简洁视觉引导。
- **错误/告警可视化**：
  - 未知命令、未登录、权限不足等信息使用醒目颜色；
  - 登录/当前角色显示采用高亮强调。

## 2. TCP 传输层健壮性增强

- **连接超时处理**：
  - 引入非阻塞 `connect` + `select` 实现连接超时。
- **读写超时控制**：
  - 设置 `SO_RCVTIMEO` / `SO_SNDTIMEO` 避免无限阻塞。
- **协议头解析加固**：
  - 长度字段仅允许纯数字；
  - 处理尾部换行；
  - 拒绝非法长度，提升协议鲁棒性。

## 3. Server 端网络层一致性增强

- **读写超时控制**：
  - 为服务端连接设置 `SO_RCVTIMEO` / `SO_SNDTIMEO`，避免阻塞占用线程。
- **协议头解析加固**：
  - 与客户端一致，仅允许纯数字长度并剔除换行，非法头直接拒绝。

## 3. 端到端联调验证（过程说明）

- 按角色完整验证论文流程：
  - AUTHOR 上传/修订/状态查询；
  - EDITOR 分配/查看/终审；
  - REVIEWER 领取任务/下载/提交评审；
  - ADMIN 备份/恢复/缓存统计等。
- 验证客户端-服务器交互链路，确保协议与逻辑一致。

---

如需更细粒度的变更细节（逐文件、逐函数或 commit 级别记录），可在此基础上继续补充。

# Changes for filesystem

* 更新了快照恢复流程，对根 inode 的元数据进行规范化，并修复根目录项 `"."` / `".."`，使其正确指向 `ROOT_INODE`。
* 在 `FileSystem::walk()` 和 `FileSystem::removeRecursive()` 中降低了锁嵌套层级：在调用 `Directory` 相关方法前先释放文件系统互斥锁，同时保留“活动操作”跟踪机制，以确保卸载过程的安全性。